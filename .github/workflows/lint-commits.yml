name: Lint commits
on:
  workflow_call:
    inputs:
      token:
        description: "TODO"
        type: string
        default: ${{ github.token }}
      config-file:
        description: "TODO"
        type: string
        default: '.github/ci.el'

jobs:
  lint-commits:
    timeout-minutes: 10
    runs-on: ubuntu-latest
    steps:
      - uses: styfle/cancel-workflow-action@0.9.1
        with.access_token: ${{ inputs.token }}

      - name: Set up Doom Emacs CI
        uses: doomemacs/ci@legacy

      - name: Checkout current project
        uses: actions/checkout@v3.0.2
        with.fetch-depth: 0

      - name: Run commit linter
        run: doom -f ${{ inputs.config-file }} ci lint-commits ${{ github.event.pull_request.base.sha }} ${{ github.event.pull_request.head.sha }}
